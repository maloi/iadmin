{% extends "base.html" %}

{% block css %}
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
{% endblock css %}

{% block js %}
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script>
$(function() {
    $("#addMemberInput").click(function() {
        event.preventDefault();
        $("#memberList").append("<li><input type='text' name='membercn' value='' /><input type='hidden' name='memberUid' value='' /><button>-</button></li>")
        $("#memberList li:last > input[name='membercn']").autocomplete({
            source: "{% url 'ajax_user_autocomplete' %}",
            select: function (event, ui) {
                $(this).next().val(ui.item.uid);
            }
        });
        $("#memberList li:last > button").click(function() {
            event.preventDefault();
            $(this).parent().remove();
        });
    });
    $("li > button").click(function() {
        event.preventDefault();
        $(this).parent().remove();
    });
    $(document).ready(function () {
        $("input[name='membercn']").autocomplete({
            source: "{% url 'ajax_user_autocomplete' %}",
            select: function (event, ui) {
                $(this).next().val(ui.item.uid);
            }
        });
    });
    $("input[value='Abschicken']").click(function() {
        $("input[name='membercn']").each(function() {
            if ($(this).val() === '' || $(this).val() === null) {
                $(this).parent().remove();
            }
        });
    });
});
</script>
{% endblock js %}

{% block content %}
<form action="" method="post">{% csrf_token %}
    {{ form.non_field_errors }}
    {{ form.errors }}
    <p><label for="{{ form.cn.auto_id }}">{{ form.cn.label }}: </label>{{ form.cn }}</p>
    <p><label for="{{ form.gidNumber.auto_id }}">{{ form.gidNumber.label }}: </label>{{ form.gidNumber }}</p>
    <p><label for="{{ form.description.auto_id }}">{{ form.description.label }}: </label>{{ form.description }}</p>
    <p><label for="{{ form.mail.auto_id }}">{{ form.mail.label }}: </label>{{ form.mail }}</p>
    <p><label for="{{ form.owner.auto_id }}">{{ form.owner.label }}: </label>{{ form.owner }}</p>
    <ul id="memberList">
    {% for member in form.memberUid.value %}
    <li>
        <input type="text" name="membercn" value="{{ member.cn }}" />
        <input type="hidden" name="memberUid" value="{{ member.uid }}" />
        <button>-</button>
    </li>
    {% endfor %}
    </ul>
    <p><button id="addMemberInput">+</button></p>
    <input type="submit" value="Abschicken">
</form>
<ul>
{% for member in invalidMembers %}
    <li>{{ member }}</li>
{% endfor %}
</ul>
{% endblock content %}
